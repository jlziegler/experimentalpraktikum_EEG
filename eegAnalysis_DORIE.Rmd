---
title: "EEG Analysis Dorie (iMMN)"
author: "Joshua Ziegler"
date: "12.01.2021"
output: html_document
---

Vor der Analyse in R:    

- Einladen der Daten in EEGLab    
- Exportieren als .set -> wird hierfür MNE benötigt?    
- oder exportieren als EDF? -> benötigt biosig

```{r setup, include=FALSE}
# packages
library(eegUtils) # angefangen mit Version 0.5.0
library(tidyverse)
```

1. Schritt:     
Laden der Daten in EEGLAB -> exportieren als .set -> laden des Datensets in R (.set & .fdt benötigt):   
```{r load data, echo=T}
# test <- import_set("./raw/DOR_02.set")
```

Fehlermeldung:

> Fehler: Can't subset columns that don't exist.  
> x Column `epoch` doesn't exist.

-> Muss wirklich schon die Epochierung gemacht sein? Wozu gibt es dann die Funktion ```epoch_data()```? -> Erstmal versuchen, die Channel-Locations zu definieren   

Versuch 2 (Channel Locations in EEGLAB definiert):

-> gleiche Fehlermeldung -> nächster Schritt: Develop Branch von GitHub geladen:   
```remotes::install_github("craddm/eegUtils@develop")```    

Versuch 3: versuchen die .vhdr-Datei mit der Funktion ```import_raw()``` zu laden:

# Daten importieren
```{r import raw, echo=T}
dor02_raw <- import_raw("./raw/DOR02.vhdr", participant_id = "DOR02")
```

-> klappt! Einzige Sorge: **"No channel locations found"** -> nur für Topo relevant
-> Lösung: ```electrode_locations()```

# Channel-Locations zuweisen
```{r channel locations, echo=T}
dor02_chl <- electrode_locations(dor02_raw, 
                                 overwrite = T
                                 )
```

# Vorverarbeitung   

## Daten filtern
```{r bandpass, echo=T}
dor02_flt <- eeg_filter(dor02_chl,
                        low_freq = 0.1,
                        high_freq = 30,
                        method = "fir"
                        )
```

## Re-Referenzierung
```{r re-ref, echo=T}
dor02_ref <- eeg_reference(dor02_flt, 
                           ref_chans = c("A1", "A2")
                           )
```

## Ausschließen der Muskelartefakte
????

## Epochierung
```{r epoch, echo=T}
dor02_epo <- epoch_data(dor02_ref,
                        events = c("S111",
                                   "S112",
                                   "S212",
                                   "S211",
                                   "S121",
                                   "S123",
                                   "S223",
                                   "S221"),
                        epoch_labels = c("oeStan",    # o-e (o-Standard)
                                         "eoStan",    
                                         "oeDev",
                                         "eoDev",     # e-o (o-Deviant)
                                         "ouStan",
                                         "uoStan",
                                         "ouDev",
                                         "uoDev"),
                        time_lim = c(-.2, .8),
                        baseline = c(-.2, 0))
```





Funktionensammlung:   

- Browse Data: ```browse_data(data)```
- Plot Power Spectral Density: ```plot_psd()```
- Eventliste: ```list_events()```
- ERP-Plot Example: ```plot_timecourse(dor02_epo, "FCz", colour = "event_type")``` -> plot Funktionen sind ggplot objekte! 
```{r}
# grober example plot
dor02_epo %>%
select_elecs(c("F8", "FC6")) %>%
filter(epoch_labels %in% c("uoDev", "ouStan")) %>%
as.data.frame(long = TRUE) %>%
ggplot(aes(x = time, y = amplitude)) +
stat_summary(fun.y = mean, geom = "line", aes(colour = epoch_labels)) + facet_wrap(~electrode)
```
  
- Remove EOG using regession: ```dor02_eog <- ar_eogreg(dor02_epo, heog = c("HEOGli", "HEOGre"), veog = c("VEOGo", "VEOGu"), bipolarize = TRUE)```    
- ICA: ```dor02_ICA <- run_ICA(dor02_epo)```    
- Detect high correlation with EOG channels: ```dor02_eog2 <- ar_eogcor(decomp = dor02_ICA, data = dor02_epo, HEOG = c("HEOGli", "HEOGre"), VEOG = c("VEOGo", "VEOGu"))``` -> Was sagt der plot?    



To-do:
- Artefacts   
- Eye Movement    
- Grand Average
- Bins???
- baseline nur beim plotten?

#######

